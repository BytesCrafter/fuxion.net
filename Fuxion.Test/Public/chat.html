<!doctype html>
<html lang="en">

<body>

    <style>
        textarea {
            vertical-align: bottom;
        }

        #output {
            overflow: auto;
        }

            #output > p {
                overflow-wrap: break-word;
            }

            #output span {
                color: blue;
            }

                #output span.error {
                    color: red;
                }
    </style>
    <h2>WebSocket Test</h2>
    <input type="text" value="1">
    <textarea cols="60" rows="6"></textarea>
    <button>send</button>
    <div id="output"></div>
</body>
<script>
    // http://www.websocket.org/echo.html
    const button = document.querySelector("button");
    const output = document.querySelector("#output");
    const textarea = document.querySelector("textarea");
    const input = document.querySelector("input");
    const wsUri = "ws://localhost:4649/Chat/?name=juan";
    const websocket = new WebSocket(wsUri);

    button.addEventListener("click", onClickButton);

    websocket.onopen = (e) => {
      writeToScreen("CONNECTED");
      doSend("WebSocket rocks");
    };

    websocket.onclose = (e) => {
      writeToScreen("DISCONNECTED");
    };

    websocket.onmessage = (e) => {
      input.value = parseInt(input.value) + 1;
      writeToScreen(`<span>RESPONSE: ${e.data}</span>`);
      console.log(e.data);
    };

    websocket.onerror = (e) => {
      writeToScreen(`<span class="error">ERROR:</span> ${e.data}`);
    };

    function doSend(message) {
      //writeToScreen(`SENT: ${message}`);
      websocket.send(message);
    }

    function writeToScreen(message) {
      output.insertAdjacentHTML("afterbegin", `<p>${message}</p>`);
    }

    setInterval(() => {
      //doSend("The red brown fox jump over the lazy daog.");
    }, 100)

    function onClickButton() {
      const text = textarea.value;

      text && doSend(text);
      textarea.value = "";
      textarea.focus();
    }
</script>
</html>
